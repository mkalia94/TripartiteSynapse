#!/bin/bash

# ---------------------------------------------------
# Run Experiments using the TriSyn package using Bash
# ---------------------------------------------------

# ECS sizes contains three ECS sizes, small, medium and big, that correspond to initial
# extracellular ratios of 20%, 50% and 98% (~infinite).

# Experiments has the interventions/experiments you want to run. Please do aedit them as per
# your convenience. The following options are available:
#  1. --tstart TSTART  : start energy deprivation at TSTART.
#  2. --tend TEND : stop energy deprivation at TEND.
#  3. --perc PERC : (PERC*100)% of energy available during energy deprivation
#  4. --tfinal TFINAL : stop experiment at TFINAL
#  5. --excite TSTART TFINAL : excite the neuron with 5pA current starting at TSTART
#                              and ending at TEND
#  6. --astblock TSTART TFINAL : block all astrocyte interactions starting at TSTART
#                               and ending at TEND
#  7. --block {\"CURRENT\":[TSTART,TEND],...} : block CURRENT starting at TSTART
#                               and endning at TEND. Multiple such terms can
#                               be appended in the dict.
#  8. --nogates : Makes the simulation much faster by setting m,h and n to their
#                 equilibrium values, useful if you only want to see ion concentration dynamics
#  9. --nosynapse : Blocks all synaptic processes (glutamate recyling, GLT, NCX)



declare -A ECSsizes
ECSsizes=( ["-s"]="SmallECS"
           ["-m"]="MedECS"
           ["-b"]="BigECS")

declare -A Experiments
Experiments=( ["INCXiblock"]="--tstart 20 --tend 40 --block {\"INCXi\":[100,120]} --tfinal 180"
              ["Calibration"]="--tstart 20 --tend 21.7 --perc 0.2 --tfinal 40"
              ["HealthyResponse"]="--tstart 500 --tend 600 --tfinal 30 --excite 0 20"
              ["AstKnockHealthy"]="--tstart 500 --tend 600 --tfinal 30 --excite 0 20 --astblock 10 30"
              ["UnhealthyResponse"]="--tstart 20 --tend 40 --tfinal 100 --excite 60 80"
	      ["NoSynapse"]="--tstart 20 --tend 40 --tfinal 100 --nosynapse"
	      ["NoGates"]="--tstart 20 --tend 40 --tfinal 100 --nogates")


# In the for loop below, you can change the arguments plot and titles to include
# whatever you would like to plot.


for name_ in "${!Experiments[@]}"; do
  for size_ in "${!ECSsizes[@]}"; do
    python set_up.py \
    --gltScale 2 --pumpScaleNeuron 2 --pumpScaleAst 2 \
    --name "${ECSsizes[$size_]}" \
    ${Experiments[$name_]} \
    $size_ \
    --solve \
    --write \
    --plot '{"MemPot":["Vi","Vg"],"Na":["NaCi","NaCg"],"Glu1":["GluCi","GluCg"],"Glu2":["GluCc"],"Ca":["CaCi","CaCc","CaCg"]}' \
    --titles '{"MemPot":"Membrane potential (in mV)","Na":"$[Na^+]$ (in mM)","W": "Volume (in pL)", "Glu1": "[Glu] (in mM)","Glu2":"[Glu] (in mM)","Ca":"$[Ca^{2+}]$ (in mM)" }' \
    --saveloc "$name_/${ECSsizes[$size_]}"
  done; 
done
